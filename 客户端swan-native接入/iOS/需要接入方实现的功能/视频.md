
## 功能说明

智能小程序提供了视频播放能力，通过实现 video 抽象接口就可以轻松让您的小程序拥有定制化的视频播放器，让小程序的的产品体验及产品功能更加完善。
开发者通过 swan.createVideoContext 来创建一个播放器实例，后续有关播放器的操作均在此对象上完成。

## 相关协议
BBAMNPVideoProtocol

## 接入方法
+ 遵循`BBAMNPVideoProtocol`协议，实现相关接口。
+ 在相应时机调用**BBAMNPVideoHandleDelegate**代理方法。


## 方法列表

## BBAMNPVideoProtocol

### 1. 播放视频

+ 播放视频基本能力的接口。
+ 小程序框架会提供父视图让宿主app将播放组件设置为其子视图。 
+ 小程序框架会提供frame让宿主设置播放组件的frame。
+ 小程序框架提供代理对象来接受播放中的各种事件。

```
/**
 * 播放视频
 *
 *@param superView 父视图
 *@param frame frame
 *@param videoInfo 视频信息
 * @{
 *        @"videoId": String,
 *        @"appId": String,
 *        @"vid": String,
 *        @"slaveId": String,
 *        @"autoplay": String
 *}
 *@param delegate BBAMNPVideoHandleDelegate
 *@return 是否当前要播放的视频已经播放了
 */
+ (BOOL)playVideoInView:(UIView *)superView
              withFrame:(CGRect)frame
              videoInfo:(NSDictionary *)videoInfo
               delegate:(id<BBAMNPVideoHandleDelegate>)delegate;
```

### 2. 暂停播放器
```
+ (void)pause;
```

### 3. 停止
```
+ (void)stop;
```

### 4. 关闭播放器
```
+ (void)closePlayer;
```

### 5. 重新播放视频
```
+ (void)replay;
```

### 6. 跳到指定时间播放
```
+ (void)seek:(double)seconds;
```

### 7. 进入全屏
```
+ (void)enterFullScreen;
```

### 8. 退出全屏
```
+ (void)exitFullScreen;
```

### 9. 播放器代理
```
+ (id)delegate;
```

### 10. 播放器当前播放模式
```
+ (NSUInteger)currentPlayerMode;
```

### 11. 发送弹幕信息
```
+ (void)sendDanmu:(NSDictionary *)barrage;
```

### 12. 更新弹幕信息
```
+ (void)updateBarrageMeta:(NSDictionary *)barrageMeta;
```

### 13. 外部更新弹幕信息
```
+ (void)updateBarrageList:(NSArray *)barrageList;
```

### 14. 更新播放器的数据
```
+ (void)updateVideoInfo:(NSDictionary *)videoInfo;
```

### 15. 播放器的父视图
```
+ (UIView *)currentPlayerSurperView;
```

### 16. 当前播放状态
```
+ (int)currentPlayerStatus;
```

### 17. 是否包含在自定义player在视图中
```
+ (BOOL)containCustomPlayerInView:(UIView *)view;
```

### 18. 是否正在播放
```
+ (BOOL)currentIsPlaying;
```

### 19. 是否全屏模式
```
+ (BOOL)currentIsFullMode;
```

### 20. 更新播放器frame
```
+ (void)updatePlayerFrame:(CGRect)frame vid:(NSString *)vid;
```
### 21. 设置是否开启手势
```
/**
 是否开启音量、亮度调节手势

 @param enable YES 开启
 */
+ (void)panGestureEnabled:(BOOL)enable;
```

### 22. 亮度 音量,进度手势开关

```
/**
 
 亮度 音量,进度手势开关
 @param enable YES 开启
 */
+ (void)setBrightnessVolumeAndProgressGestureEnabled:(BOOL)enable;
```

### 23. 修改当前视频为静音模式
```
/**
 修改当前视频为静音模式
 
 @param 是否静音
 */
+ (BOOL)changeCurrentVideoSilencePlayer:(BOOL)isSilence;
```

### 24. 获取当前播放视频的进度

```
/**
 获取当前播放视频的进度
 
 @return 当前视频播放进度
 */
+ (CGFloat)currentPlayerTime;
```

### 25. 清空缓存
```
// 清空缓存
+ (void)clearCache;
```

## BBAMNPVideoHandleDelegate

### 1. play事件

当视频开始播放时，宿主应该调用代理的此方法。
```
// 当开始/继续播放时触发play事件回调
- (void)playerDidPlay:(NSString *)videoId;
```

### 2. play成功事件
当视频播放成功时，宿主应该调用代理的此方法。

```
// 播放器播放成功回调
- (void)playerDidPlaySuccess:(NSString *)videoId;
```

### 3. 播放暂停事件
当视频暂停时候，宿主应该调用代理的此方法。

```
// 当播放到末尾时触发 ended 事件回调
- (void)playerDidPause:(NSString *)videoId;
```

### 4. 播放结束事件
当播放到末尾时,宿主应该调用代理此方法。

```
// 当播放到末尾时触发 ended 事件回调
- (void)playerDidEnd:(NSString *)videoId;
```

### 4. 播放器转屏
+ 播放器转屏时，宿主需要调用此方法

```
typedef enum : NSUInteger {
    BBAMNPPlayerModeFull,   //全屏
    BBAMNPPlayerModeMini,   //小窗播放器，内置maxsize及minsize
    BBAMNPPlayerModeCustom, //自定义大小，页内播放
    BBAMNPPlayerModeNone    //当前没有定义播放器
} BBAMNPPlayerMode;

// 播放器转屏回调
- (void)playerScreenChangeToNewMode:(BBAMNPPlayerMode)newMode
                           oldModel:(BBAMNPPlayerMode)oldModel
                            videoId:(NSString *)videoId
                              frame:(CGRect)newFrame;
```

### 5. 播放器更新进度

播放器更新进度后宿主需要调用此方法

```
//player更新播放进度
- (void)videoPlayerUpdateTimeProgress:(double)currentTime
                             duration:(double)duration
                              videoId:(NSString *)videoId;
```

### 6. 发送弹幕

宿主发送弹幕实现结束后，需要调用此方法

```
/**
 全屏下播放器发送弹幕回调
 
 @param content  输入的内容
 @param playAtTime 发送的时间
 */
- (void)playerSendBarrage:(NSString *)content
               playAtTime:(NSString *)playAtTime
                  videoId:(NSString *)videoId;
```

### 7.小程序播放器是否安装弹幕组件

```
///小程序播放器是否安装弹幕组件
- (BOOL)playerShouldShowBarrageComponent:(BBAMNPPlayerBarrageComponent)cmp
                          withPlayerMode:(BBAMNPPlayerMode)playerMode;
```

### 8.播放器弹幕是否需要根据视频播放进度从服务端动态拉取弹幕数据

```
- (BOOL)isNeedUpdateBarrageListFromServer;
```

### 8.是否需要在点击发送按钮后清除草稿（无论弹幕发送成功与否）

```
- (BOOL)isNeedClearDraftAfterSendClick;
```

### 9.播放器视图被添加到父视图
```
- (void)playerViewDidAddedToSurperView:(UIView *)playerView vid:(NSString *)vid;
```

### 10. 播放器视图从父视图里移除.
```
- (void)playerViewDidRemovedFromSurperView:(UIView *)playerView vid:(NSString *)vid;
```

### 11. 播放器delegate将要改变
```
- (void)playerDelegateWillChanged:(id<BBAMNPVideoHandleDelegate>)newDelegate vid:(NSString *)vid;
```

### 12. 播放器 vid将要改变
```
- (void)playerVidWillChanged:(NSString *)oldVid;
```










